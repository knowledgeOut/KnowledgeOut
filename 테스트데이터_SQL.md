use koDB;

-- =====================================================
-- 1. 회원 데이터 (5명 - 첫번째 admin, 5번째 탈퇴회원)
-- 비밀번호: 12341234 (BCrypt 암호화됨)
-- =====================================================

INSERT INTO members (id, email, password, nickname, role, status, created_at, modified_at) VALUES
(1, 'admin@knowledgeout.com', '$2a$10$kpmMSb6X6B6/MUOycpNZtuIvESFzBstUqqa.aJEdzLfZyGk.L6aR.', '관리자', 'ROLE_ADMIN', 'ACTIVE', '2025-12-01 09:00:00', '2025-12-01 09:00:00'),
(2, 'user1@example.com', '$2a$10$kpmMSb6X6B6/MUOycpNZtuIvESFzBstUqqa.aJEdzLfZyGk.L6aR.', '개발자철수', 'ROLE_USER', 'ACTIVE', '2025-12-05 10:30:00', '2025-12-05 10:30:00'),
(3, 'user2@example.com', '$2a$10$kpmMSb6X6B6/MUOycpNZtuIvESFzBstUqqa.aJEdzLfZyGk.L6aR.', '코딩영희', 'ROLE_USER', 'ACTIVE', '2025-12-10 14:20:00', '2025-12-10 14:20:00'),
(4, 'user3@example.com', '$2a$10$kpmMSb6X6B6/MUOycpNZtuIvESFzBstUqqa.aJEdzLfZyGk.L6aR.', '백엔드민수', 'ROLE_USER', 'ACTIVE', '2025-12-15 16:45:00', '2025-12-15 16:45:00'),
(5, NULL, '$2a$10$kpmMSb6X6B6/MUOycpNZtuIvESFzBstUqqa.aJEdzLfZyGk.L6aR.', 'deletedUser_ABC123XYZ789', 'ROLE_USER', 'DELETED', '2025-11-01 11:00:00', '2025-12-03 15:30:00');

-- =====================================================
-- 2. 카테고리 데이터 (5개)
-- =====================================================

INSERT INTO categories (id, name) VALUES
(1, 'Java'),
(2, 'JavaScript'),
(3, 'Python'),
(4, 'Database'),
(5, '기타');

-- =====================================================
-- 3. 태그 데이터 (10개)
-- =====================================================

INSERT INTO tags (id, name) VALUES
(1, 'Spring Boot'),
(2, 'JPA'),
(3, 'React'),
(4, 'Next.js'),
(5, 'MySQL'),
(6, 'MongoDB'),
(7, 'REST API'),
(8, 'Docker'),
(9, '알고리즘'),
(10, '초보');

-- =====================================================
-- 4. 질문 데이터 (20개)
-- ⚠️ status 필드 의미:
-- false = 정상 질문 (조회됨)
-- true = 삭제된 질문 (조회 안됨)
-- ※ 답변 유무는 Answer 테이블의 실제 데이터로 판단됨
-- 날짜 범위: 2025-11-01 ~ 2026-01-06 (현재 시점 기준)
-- =====================================================

INSERT INTO questions (id, title, content, view_count, status, created_at, modified_at, member_id, category_id) VALUES
-- 2025년 11월 (2개) - 오래된 글
(1, 'Spring Boot 3.0 마이그레이션 질문', 'Spring Boot 2.7에서 3.0으로 마이그레이션하려고 합니다. 주의할 점이 있을까요?', 156, false, '2025-11-05 09:30:00', '2025-11-05 09:30:00', 2, 1),
(2, 'JPA N+1 문제 해결 방법', 'JPA를 사용하다 보니 N+1 문제가 발생합니다. 어떻게 해결해야 할까요?', 234, false, '2025-11-15 14:20:00', '2025-11-15 14:20:00', 3, 1),

-- 2025년 12월 초 (5개) - 탈퇴한 유저 글 포함
(3, 'React와 Next.js 차이점', 'React와 Next.js의 차이점이 궁금합니다. 언제 Next.js를 사용해야 하나요?', 189, false, '2025-12-01 10:15:00', '2025-12-01 10:15:00', 5, 2),
(4, 'Python 리스트 컴프리헨션 사용법', 'Python에서 리스트 컴프리헨션을 효율적으로 사용하는 방법이 궁금합니다.', 87, false, '2025-12-08 16:40:00', '2025-12-08 16:40:00', 4, 3),
(5, 'MySQL 인덱스 최적화', 'MySQL에서 인덱스를 어떻게 최적화해야 쿼리 성능이 좋아질까요?', 312, false, '2025-12-12 11:25:00', '2025-12-12 11:25:00', 2, 4),
(6, 'Docker Compose 네트워크 설정', 'Docker Compose에서 여러 컨테이너 간 네트워크 설정은 어떻게 하나요?', 145, false, '2025-12-18 08:50:00', '2025-12-18 08:50:00', 3, 5),
(7, '탈퇴한 회원의 마지막 질문', '이 글은 탈퇴한 회원이 남긴 질문입니다. 테스트용입니다.', 23, false, '2025-12-25 20:30:00', '2025-12-25 20:30:00', 5, 5),

-- 2026년 1월 초 (8개)
(8, 'Spring Security 세션 인증 구현', 'Spring Security로 세션 기반 인증을 구현하고 싶습니다. 어떻게 시작해야 하나요?', 278, false, '2026-01-01 10:00:00', '2026-01-01 10:00:00', 4, 1),
(9, 'JavaScript async/await 이해하기', 'JavaScript의 async/await가 어떻게 동작하는지 이해가 잘 안됩니다.', 198, false, '2026-01-02 13:30:00', '2026-01-02 13:30:00', 2, 2),
(10, 'REST API 설계 원칙', 'RESTful API를 설계할 때 지켜야 할 원칙들이 궁금합니다.', 167, false, '2026-01-02 15:45:00', '2026-01-02 15:45:00', 3, 5),
(11, 'Python Django vs Flask', 'Python 웹 프레임워크 중 Django와 Flask 중 어떤 것을 선택해야 할까요?', 134, false, '2026-01-03 09:20:00', '2026-01-03 09:20:00', 4, 3),
(12, 'MySQL vs PostgreSQL 비교', '프로젝트에서 MySQL과 PostgreSQL 중 어떤 것을 사용해야 할지 고민입니다.', 201, false, '2026-01-03 11:55:00', '2026-01-03 11:55:00', 2, 4),
(13, 'Git 브랜치 전략 추천', 'Git 브랜치 전략 중 Git Flow와 GitHub Flow 중 어떤 것이 좋을까요?', 89, false, '2026-01-04 14:10:00', '2026-01-04 14:10:00', 3, 5),
(14, 'JPA 영속성 컨텍스트 개념', 'JPA의 영속성 컨텍스트가 정확히 무엇인지 설명해주실 수 있나요?', 256, false, '2026-01-04 16:30:00', '2026-01-04 16:30:00', 1, 1),
(15, 'React useEffect 무한 루프 문제', 'React에서 useEffect가 무한 루프에 빠지는 문제가 있습니다. 원인이 뭘까요?', 178, false, '2026-01-05 10:45:00', '2026-01-05 10:45:00', 4, 2),

-- 2026년 1월 최근 (5개) - 미답변 글 다수
(16, 'MongoDB 스키마 설계 질문', 'MongoDB에서 스키마를 어떻게 설계해야 효율적일까요?', 45, false, '2026-01-05 14:20:00', '2026-01-05 14:20:00', 2, 4),
(17, 'Next.js App Router vs Pages Router', 'Next.js에서 App Router와 Pages Router의 차이점이 궁금합니다.', 67, false, '2026-01-05 17:30:00', '2026-01-05 17:30:00', 3, 2),
(18, 'Spring Boot 테스트 코드 작성법', 'Spring Boot에서 효과적인 테스트 코드를 작성하는 방법이 궁금합니다.', 32, false, '2026-01-06 09:00:00', '2026-01-06 09:00:00', 4, 1),
(19, '알고리즘 공부 순서 추천', '코딩 테스트를 위한 알고리즘 공부 순서를 추천해주세요.', 56, false, '2026-01-06 11:30:00', '2026-01-06 11:30:00', 2, 5),
(20, 'Docker 이미지 최적화 방법', 'Docker 이미지 용량을 줄이는 방법이 궁금합니다.', 28, false, '2026-01-06 14:00:00', '2026-01-06 14:00:00', 3, 5);

-- =====================================================
-- 5. 답변 데이터
-- ⚠️ 답변의 status 필드:
-- false = 정상 답변
-- true = 삭제된 답변
-- 답변이 있는 질문: 1,2,3,4,5,8,9,10,12,14,15 (11개)
-- 미답변 질문: 6,7,11,13,16,17,18,19,20 (9개)
-- =====================================================

INSERT INTO answers (id, content, question_id, member_id, status, created_at, modified_at) VALUES
-- 질문 1번 답변 (2개)
(1, 'Spring Boot 3.0 마이그레이션시 가장 중요한 것은 Java 17 이상으로 업그레이드하는 것입니다. 또한 javax 패키지가 jakarta로 변경되었으니 import문을 모두 수정해야 합니다.', 1, 1, false, '2025-11-06 10:30:00', '2025-11-06 10:30:00'),
(2, '추가로 Spring Security 설정 방식도 많이 바뀌었습니다. WebSecurityConfigurerAdapter가 deprecated되었으니 SecurityFilterChain을 사용하세요.', 1, 4, false, '2025-11-07 14:20:00', '2025-11-07 14:20:00'),

-- 질문 2번 답변 (1개)
(3, 'N+1 문제는 주로 fetch join이나 @EntityGraph를 사용해서 해결합니다. JPQL에서 JOIN FETCH를 사용하면 연관된 엔티티를 한 번에 조회할 수 있습니다.', 2, 1, false, '2025-11-16 09:15:00', '2025-11-16 09:15:00'),

-- 질문 3번 답변 (탈퇴 회원 질문에 답변)
(4, 'Next.js는 SSR, SSG 등 다양한 렌더링 방식을 지원하고 파일 기반 라우팅이 내장되어 있습니다. SEO가 중요하거나 초기 로딩 속도가 중요한 프로젝트에 적합합니다.', 3, 2, false, '2025-12-02 11:30:00', '2025-12-02 11:30:00'),

-- 질문 4번 답변
(5, '리스트 컴프리헨션은 [표현식 for 항목 in 반복가능객체 if 조건]의 형태로 사용합니다. 예: squares = [x**2 for x in range(10) if x % 2 == 0]', 4, 3, false, '2025-12-09 10:00:00', '2025-12-09 10:00:00'),

-- 질문 5번 답변 (2개)
(6, 'MySQL 인덱스 최적화 팁: 1) WHERE절에 자주 사용되는 컬럼에 인덱스 생성 2) 복합 인덱스 사용시 카디널리티가 높은 컬럼을 앞에 배치 3) EXPLAIN으로 쿼리 실행 계획 확인', 5, 1, false, '2025-12-13 09:30:00', '2025-12-13 09:30:00'),
(7, '추가로 불필요한 인덱스는 오히려 INSERT/UPDATE 성능을 저하시키니 주의하세요. 인덱스 사용률을 모니터링하는 것도 중요합니다.', 5, 4, false, '2025-12-14 15:45:00', '2025-12-14 15:45:00'),

-- 질문 8번 답변
(8, 'Spring Security 세션 인증은 SecurityFilterChain에서 formLogin()이나 httpBasic()을 설정하면 됩니다. 세션 정책은 sessionManagement()에서 설정할 수 있습니다.', 8, 3, false, '2026-01-01 14:30:00', '2026-01-01 14:30:00'),

-- 질문 9번 답변
(9, 'async/await는 Promise를 더 쉽게 다루기 위한 문법입니다. async 함수는 항상 Promise를 반환하고, await는 Promise가 resolve될 때까지 기다립니다.', 9, 1, false, '2026-01-02 16:00:00', '2026-01-02 16:00:00'),

-- 질문 10번 답변
(10, 'REST API 설계 원칙: 1) 리소스 중심 URL 설계 2) HTTP 메서드 적절히 활용 3) 상태 코드 올바르게 반환 4) 버전 관리 5) HATEOAS 고려', 10, 4, false, '2026-01-02 18:30:00', '2026-01-02 18:30:00'),

-- 질문 12번 답변
(11, 'MySQL은 읽기 성능이 좋고 사용이 쉽습니다. PostgreSQL은 복잡한 쿼리와 대용량 데이터 처리에 강합니다. 프로젝트 요구사항에 따라 선택하세요.', 12, 1, false, '2026-01-03 14:20:00', '2026-01-03 14:20:00'),

-- 질문 14번 답변 (2개)
(12, '영속성 컨텍스트는 엔티티를 영구 저장하는 환경입니다. 1차 캐시, 동일성 보장, 트랜잭션을 지원하는 쓰기 지연, 변경 감지, 지연 로딩 기능을 제공합니다.', 14, 2, false, '2026-01-04 18:00:00', '2026-01-04 18:00:00'),
(13, '추가 설명: persist()로 영속 상태로 만들고, find()로 조회하면 1차 캐시에서 먼저 찾습니다. flush()는 변경사항을 DB에 동기화합니다.', 14, 4, false, '2026-01-05 09:30:00', '2026-01-05 09:30:00'),

-- 질문 15번 답변
(14, 'useEffect 무한 루프는 보통 의존성 배열 문제입니다. 의존성 배열에 매번 새로 생성되는 객체나 함수가 있으면 무한 루프가 발생합니다. useMemo나 useCallback을 사용하세요.', 15, 3, false, '2026-01-05 12:00:00', '2026-01-05 12:00:00'),

-- 삭제된 답변 (soft delete 테스트용)
(15, '이 답변은 삭제되었습니다. (테스트용 soft delete 답변)', 1, 3, true, '2025-11-08 10:00:00', '2025-11-10 15:00:00');

-- =====================================================
-- 6. 질문-태그 매핑 (관리자 대시보드 태그 통계용)
-- 태그 사용 빈도:
-- Spring Boot(1): 6회
-- JPA(2): 4회
-- React(3): 4회
-- Next.js(4): 3회
-- MySQL(5): 3회
-- MongoDB(6): 1회
-- REST API(7): 3회
-- Docker(8): 3회
-- 알고리즘(9): 2회
-- 초보(10): 3회
-- =====================================================

INSERT INTO question_tags (id, question_id, tag_id) VALUES
-- 질문 1: Spring Boot, JPA
(1, 1, 1),
(2, 1, 2),

-- 질문 2: JPA, 초보
(3, 2, 2),
(4, 2, 10),

-- 질문 3: React, Next.js
(5, 3, 3),
(6, 3, 4),

-- 질문 4: 초보 (Python 초보자 질문)
(7, 4, 10),

-- 질문 5: MySQL
(8, 5, 5),

-- 질문 6: Docker
(9, 6, 8),

-- 질문 8: Spring Boot, REST API
(10, 8, 1),
(11, 8, 7),

-- 질문 9: React (JavaScript async는 React에서도 자주 사용)
(12, 9, 3),

-- 질문 10: REST API
(13, 10, 7),

-- 질문 11: 초보 (프레임워크 선택 고민은 초보)
(14, 11, 10),

-- 질문 12: MySQL
(15, 12, 5),

-- 질문 14: JPA, Spring Boot
(16, 14, 2),
(17, 14, 1),

-- 질문 15: React
(18, 15, 3),

-- 질문 16: MongoDB
(19, 16, 6),

-- 질문 17: Next.js, React
(20, 17, 4),
(21, 17, 3),

-- 질문 18: Spring Boot, JPA
(22, 18, 1),
(23, 18, 2),

-- 질문 19: 알고리즘
(24, 19, 9),

-- 질문 20: Docker, Spring Boot
(25, 20, 8),
(26, 20, 1),

-- 추가: 더 많은 태그 사용 (기간별 태그 통계 테스트용)
-- 질문 7 (탈퇴회원 글): 알고리즘
(27, 7, 9),

-- 질문 6: REST API 추가
(28, 6, 7),

-- 질문 13: Docker 추가
(29, 13, 8),

-- 질문 5: MySQL에 추가로 Spring Boot
(30, 5, 1),

-- 질문 8: Next.js 추가
(31, 8, 4),

-- 질문 12: MySQL 중복 제거하고 다른 태그 추가 안함 (이미 있음)
(32, 13, 10);

-- =====================================================
-- 7. 질문 추천 데이터
-- =====================================================

INSERT INTO question_likes (id, member_id, question_id, created_at) VALUES
(1, 2, 1, '2025-11-10 09:00:00'),
(2, 3, 1, '2025-11-12 14:30:00'),
(3, 4, 1, '2025-11-15 11:20:00'),
(4, 1, 2, '2025-11-20 16:45:00'),
(5, 4, 2, '2025-11-22 10:15:00'),
(6, 2, 5, '2025-12-15 13:00:00'),
(7, 3, 5, '2025-12-18 09:30:00'),
(8, 1, 8, '2026-01-02 11:00:00'),
(9, 2, 10, '2026-01-03 15:20:00'),
(10, 4, 14, '2026-01-05 10:00:00');

-- =====================================================
-- Auto Increment 값 재설정 (다음 INSERT를 위해)
-- =====================================================

ALTER TABLE members AUTO_INCREMENT = 6;
ALTER TABLE categories AUTO_INCREMENT = 6;
ALTER TABLE tags AUTO_INCREMENT = 11;
ALTER TABLE questions AUTO_INCREMENT = 21;
ALTER TABLE answers AUTO_INCREMENT = 16;
ALTER TABLE question_tags AUTO_INCREMENT = 33;
ALTER TABLE question_likes AUTO_INCREMENT = 11;

-- =====================================================
-- 테스트 데이터 요약
-- =====================================================
--
-- 회원 (5명):
-- - ID 1: 관리자 (admin@knowledgeout.com)
-- - ID 2-4: 일반 사용자
-- - ID 5: 탈퇴 회원
--
-- 🔑 모든 계정 비밀번호: 12341234
--
-- 카테고리 (5개): Java, JavaScript, Python, Database, 기타
--
-- 태그 (10개) 사용 빈도:
-- - Spring Boot: 6회 ⭐
-- - JPA: 4회
-- - React: 4회
-- - Next.js: 3회
-- - MySQL: 2회
-- - REST API: 3회
-- - Docker: 3회
-- - 초보: 4회
-- - 알고리즘: 2회
-- - MongoDB: 1회
--
-- 질문 (20개):
-- ⚠️ status=false: 정상 질문 (모든 질문)
-- ⚠️ status=true: 삭제된 질문 (없음)
-- - 답변 있음: 11개 (질문 1,2,3,4,5,8,9,10,12,14,15)
-- - 미답변: 9개 (질문 6,7,11,13,16,17,18,19,20)
-- - 탈퇴 회원 글: 2개 (질문 3, 7)
-- - 날짜 범위: 2025-11-05 ~ 2026-01-06 (현재 시점 기준)
--
-- 답변 (15개):
-- - 활성 답변: 14개
-- - 삭제된 답변 (soft delete): 1개
--
-- 관리자 대시보드 테스트:
-- - 최근 24시간: 2026-01-06 데이터 (질문 18,19,20 - 3개)
-- - 최근 7일: 2026-01-01~06 데이터 (질문 8~20 - 13개)
-- - 최근 30일: 2025-12-08~2026-01-06 데이터 (질문 4~20 - 17개)
-- - 인기 태그/카테고리가 기간별로 다르게 표시됨
-- =====================================================

-- admin계정 변환용 쿼리 회원가입하고 바꾸기
UPDATE members
SET
role = 'ROLE_ADMIN',
modified_at = NOW()
WHERE id = 6;
